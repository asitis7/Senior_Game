<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹œë‹ˆì–´ ê²Œì„</title>
    
    <!-- PWA ë©”íƒ€ íƒœê·¸ -->
    <meta name="theme-color" content="#4CAF50">
    <meta name="description" content="ì‹œë‹ˆì–´ë¥¼ ìœ„í•œ ê²Œì„">
    
    <!-- iOS ì „ìš© ë©”íƒ€ íƒœê·¸ -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ì‹œë‹ˆì–´ ê²Œì„">
    
    <!-- ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ ë§í¬ -->
    <link rel="manifest" href="manifest.json">
    
    <!-- íŒŒë¹„ì½˜ ë° ì•„ì´ì½˜ -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Malgun Gothic', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .installer-container {
            background: white;
            border-radius: 25px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
            padding: 50px 40px;
            text-align: center;
            max-width: 450px;
            width: 100%;
            position: relative;
        }
        
        .app-icon {
            width: 120px;
            height: 120px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            border-radius: 25px;
            margin: 0 auto 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 70px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            box-shadow: 0 10px 25px rgba(76, 175, 80, 0.3);
        }
        
        h1 {
            font-size: 32px;
            color: #333;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .description {
            font-size: 18px;
            color: #666;
            margin-bottom: 35px;
            line-height: 1.5;
        }
        
        .install-button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 20px 50px;
            font-size: 22px;
            font-weight: bold;
            border-radius: 15px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
            transition: all 0.3s ease;
        }
        
        .install-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(76, 175, 80, 0.4);
        }
        
        .install-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .status-message {
            font-size: 16px;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            display: none;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #99d3ff;
        }
        
        .status-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .manual-instructions {
            display: none;
            text-align: left;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .manual-instructions h3 {
            color: #495057;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .manual-instructions ol {
            padding-left: 20px;
        }
        
        .manual-instructions li {
            margin-bottom: 8px;
            line-height: 1.4;
        }
        
        .device-check {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 20px;
        }
        
        .loading-spinner {
            display: none;
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .skip-button {
            background: transparent;
            color: #666;
            border: 2px solid #ddd;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
        }
        
        .skip-button:hover {
            background: #f8f9fa;
            border-color: #adb5bd;
        }
        
        @media (max-width: 500px) {
            .installer-container {
                padding: 30px 25px;
            }
            
            .app-icon {
                width: 100px;
                height: 100px;
                font-size: 60px;
            }
            
            h1 {
                font-size: 26px;
            }
            
            .install-button {
                font-size: 20px;
                padding: 18px 40px;
            }
        }
    </style>
</head>
<body>
    <div class="installer-container">
        <div class="app-icon">ğŸ®</div>
        
        <h1>ì‹œë‹ˆì–´ ê²Œì„</h1>
        <p class="description">í™ˆ í™”ë©´ì— ê²Œì„ì„ ì„¤ì¹˜í•˜ì—¬<br>ì–¸ì œë“ ì§€ ì‰½ê²Œ ì¦ê¸°ì„¸ìš”!</p>
        
        <div class="device-check" id="deviceCheck">ê¸°ê¸° í™•ì¸ ì¤‘...</div>
        
        <button class="install-button" id="installButton" onclick="installApp()">
            ğŸ“± í™ˆ í™”ë©´ì— ì„¤ì¹˜í•˜ê¸°
        </button>
        
        <div class="loading-spinner" id="loadingSpinner"></div>
        
        <div class="status-message" id="statusMessage"></div>
        
        <div class="manual-instructions" id="manualInstructions">
            <h3>ğŸ“‹ ìˆ˜ë™ ì„¤ì¹˜ ë°©ë²•</h3>
            <div id="iosInstructions" style="display: none;">
                <strong>iPhone/iPad ì„¤ì¹˜ ë°©ë²•:</strong>
                <ol>
                    <li>Safari ë¸Œë¼ìš°ì €ë¡œ ì´ í˜ì´ì§€ë¥¼ ì—¬ì„¸ìš”</li>
                    <li>í™”ë©´ ì•„ë˜ìª½ ê³µìœ  ë²„íŠ¼ (â¬†ï¸)ì„ í„°ì¹˜í•˜ì„¸ìš”</li>
                    <li>"í™ˆ í™”ë©´ì— ì¶”ê°€"ë¥¼ ì°¾ì•„ì„œ í„°ì¹˜í•˜ì„¸ìš”</li>
                    <li>"ì¶”ê°€" ë²„íŠ¼ì„ í„°ì¹˜í•˜ë©´ ì„¤ì¹˜ ì™„ë£Œ!</li>
                </ol>
            </div>
            <div id="androidInstructions" style="display: none;">
                <strong>Android ì„¤ì¹˜ ë°©ë²•:</strong>
                <ol>
                    <li>Chrome ë¸Œë¼ìš°ì €ë¡œ ì´ í˜ì´ì§€ë¥¼ ì—¬ì„¸ìš”</li>
                    <li>í™”ë©´ ìš°ìƒë‹¨ ë©”ë‰´ ë²„íŠ¼ (â‹®)ì„ í„°ì¹˜í•˜ì„¸ìš”</li>
                    <li>"í™ˆ í™”ë©´ì— ì¶”ê°€" ë˜ëŠ” "ì•± ì„¤ì¹˜"ë¥¼ í„°ì¹˜í•˜ì„¸ìš”</li>
                    <li>"ì¶”ê°€" ë˜ëŠ” "ì„¤ì¹˜" ë²„íŠ¼ì„ í„°ì¹˜í•˜ë©´ ì™„ë£Œ!</li>
                </ol>
            </div>
        </div>
        
        <button class="skip-button" onclick="goToGame()">
            ì„¤ì¹˜ ì—†ì´ ë°”ë¡œ ê²Œì„í•˜ê¸° â†’
        </button>
    </div>

    <script>
        // ê²Œì„ URL
        const GAME_URL = 'https://asitis7.github.io/Senior_Game/For_Senior_Main_Menu.html';
        
        // PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸
        let deferredPrompt;
        let isInstalled = false;
        
        // ê¸°ê¸° ì •ë³´ ê°ì§€
        const userAgent = navigator.userAgent.toLowerCase();
        const isIOS = /iphone|ipad|ipod/.test(userAgent);
        const isAndroid = /android/.test(userAgent);
        const isSafari = /safari/.test(userAgent) && !/chrome/.test(userAgent);
        const isChrome = /chrome/.test(userAgent);
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', function() {
            checkDevice();
            checkIfInstalled();
            registerServiceWorker();
        });
        
        // ê¸°ê¸° í™•ì¸ ë° UI ì—…ë°ì´íŠ¸
        function checkDevice() {
            const deviceCheck = document.getElementById('deviceCheck');
            const installButton = document.getElementById('installButton');
            
            if (isIOS) {
                deviceCheck.textContent = 'ğŸ“± iPhone/iPad - ìˆ˜ë™ ì„¤ì¹˜ í•„ìš”';
                installButton.textContent = 'ğŸ“‹ ì„¤ì¹˜ ë°©ë²• ë³´ê¸°';
                showStatus('iOSì—ì„œëŠ” Safari ê³µìœ  ë²„íŠ¼ì„ í†µí•´ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.', 'info');
            } else if (isAndroid) {
                deviceCheck.textContent = 'ğŸ“± Android - ìë™ ì„¤ì¹˜ ê°€ëŠ¥';
                if (isChrome) {
                    installButton.textContent = 'ğŸ“± ìë™ìœ¼ë¡œ ì„¤ì¹˜í•˜ê¸°';
                } else {
                    installButton.textContent = 'ğŸ“‹ ì„¤ì¹˜ ë°©ë²• ë³´ê¸°';
                    showStatus('Chrome ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•˜ì‹œë©´ ìë™ ì„¤ì¹˜ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'warning');
                }
            } else {
                deviceCheck.textContent = 'ğŸ’» ì»´í“¨í„°ì—ì„œ ì ‘ì† ì¤‘';
                installButton.textContent = 'ğŸ“± ëª¨ë°”ì¼ì—ì„œ ì„¤ì¹˜ ê°€ëŠ¥';
                showStatus('ëª¨ë°”ì¼ ê¸°ê¸°ì—ì„œ ì ‘ì†í•˜ì‹œë©´ í™ˆ í™”ë©´ì— ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'info');
            }
        }
        
        // ì´ë¯¸ ì„¤ì¹˜ë˜ì—ˆëŠ”ì§€ í™•ì¸
        function checkIfInstalled() {
            // PWAê°€ ì´ë¯¸ ì„¤ì¹˜ë˜ì—ˆëŠ”ì§€ í™•ì¸
            if (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) {
                isInstalled = true;
                showStatus('âœ… ì•±ì´ ì´ë¯¸ ì„¤ì¹˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤!', 'success');
                document.getElementById('installButton').textContent = 'ğŸ® ê²Œì„ ì‹œì‘í•˜ê¸°';
                document.getElementById('installButton').onclick = goToGame;
                return;
            }
            
            // ë¸Œë¼ìš°ì € ì§€ì› ì—¬ë¶€ í™•ì¸
            if ('serviceWorker' in navigator && 'PushManager' in window) {
                console.log('PWA ì§€ì›ë¨');
            }
        }
        
        // PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì¤€ë¹„ë¨');
            e.preventDefault();
            deferredPrompt = e;
            
            // ìë™ ì„¤ì¹˜ ë²„íŠ¼ í™œì„±í™”
            document.getElementById('installButton').disabled = false;
            showStatus('âœ¨ ìë™ ì„¤ì¹˜ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤!', 'success');
        });
        
        // ì•± ì„¤ì¹˜ í•¨ìˆ˜
        async function installApp() {
            const button = document.getElementById('installButton');
            const spinner = document.getElementById('loadingSpinner');
            
            // ì´ë¯¸ ì„¤ì¹˜ëœ ê²½ìš° ê²Œì„ìœ¼ë¡œ ì´ë™
            if (isInstalled) {
                goToGame();
                return;
            }
            
            // iOSì¸ ê²½ìš° ë°”ë¡œ ìˆ˜ë™ ì„¤ì¹˜ ì•ˆë‚´
            if (isIOS) {
                showManualInstructions('ios');
                showStatus('ğŸ‘† ìœ„ì˜ ì•ˆë‚´ë¥¼ ë”°ë¼ ì„¤ì¹˜í•´ì£¼ì„¸ìš”!', 'info');
                return;
            }
            
            // ë¡œë”© ì‹œì‘ (Androidë§Œ)
            button.style.display = 'none';
            spinner.style.display = 'block';
            
            // PWA ìë™ ì„¤ì¹˜ ì‹œë„ (Android Chrome)
            if (deferredPrompt) {
                try {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    
                    if (outcome === 'accepted') {
                        showStatus('ğŸ‰ ì„¤ì¹˜ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                        setTimeout(() => {
                            goToGame();
                        }, 2000);
                    } else {
                        showStatus('ì„¤ì¹˜ê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ì„¤ì¹˜í•´ì£¼ì„¸ìš”.', 'warning');
                        showManualInstructions('android');
                    }
                    
                    deferredPrompt = null;
                } catch (error) {
                    console.error('ì„¤ì¹˜ ì˜¤ë¥˜:', error);
                    showManualInstructions('android');
                }
            } else {
                // ìˆ˜ë™ ì„¤ì¹˜ ì•ˆë‚´ (Android)
                showManualInstructions('android');
                showStatus('Chrome ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì†í•˜ì‹œë©´ ìë™ ì„¤ì¹˜ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'warning');
            }
            
            // ë¡œë”© ì¢…ë£Œ
            spinner.style.display = 'none';
            button.style.display = 'block';
        }
        
        // ìˆ˜ë™ ì„¤ì¹˜ ì•ˆë‚´ í‘œì‹œ
        function showManualInstructions(deviceType = null) {
            const manualDiv = document.getElementById('manualInstructions');
            const iosDiv = document.getElementById('iosInstructions');
            const androidDiv = document.getElementById('androidInstructions');
            
            manualDiv.style.display = 'block';
            
            if (deviceType === 'ios' || (isIOS && !deviceType)) {
                iosDiv.style.display = 'block';
                androidDiv.style.display = 'none';
            } else if (deviceType === 'android' || (isAndroid && !deviceType)) {
                androidDiv.style.display = 'block';
                iosDiv.style.display = 'none';
            } else {
                // ë‘˜ ë‹¤ í‘œì‹œ
                iosDiv.style.display = 'block';
                androidDiv.style.display = 'block';
            }
            
            showStatus('ì•„ë˜ ì•ˆë‚´ë¥¼ ë”°ë¼ ìˆ˜ë™ìœ¼ë¡œ ì„¤ì¹˜í•´ì£¼ì„¸ìš”.', 'info');
        }
        
        // ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = `status-message status-${type}`;
            statusDiv.style.display = 'block';
        }
        
        // ê²Œì„ìœ¼ë¡œ ì´ë™
        function goToGame() {
            showStatus('ê²Œì„ìœ¼ë¡œ ì´ë™ ì¤‘...', 'info');
            setTimeout(() => {
                window.location.href = GAME_URL;
            }, 1000);
        }
        
        // ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡
        async function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                try {
                    // ì¸ë¼ì¸ ì„œë¹„ìŠ¤ ì›Œì»¤ ìƒì„±
                    const swCode = `
                        const CACHE_NAME = 'senior-game-v1';
                        const urlsToCache = [
                            '/',
                            '${GAME_URL}'
                        ];
                        
                        self.addEventListener('install', (event) => {
                            event.waitUntil(
                                caches.open(CACHE_NAME)
                                    .then((cache) => cache.addAll(urlsToCache))
                            );
                        });
                        
                        self.addEventListener('fetch', (event) => {
                            event.respondWith(
                                caches.match(event.request)
                                    .then((response) => {
                                        return response || fetch(event.request);
                                    })
                            );
                        });
                    `;
                    
                    const blob = new Blob([swCode], { type: 'application/javascript' });
                    const swUrl = URL.createObjectURL(blob);
                    
                    const registration = await navigator.serviceWorker.register(swUrl);
                    console.log('ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ ì„±ê³µ:', registration);
                } catch (error) {
                    console.log('ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ ì‹¤íŒ¨:', error);
                }
            }
        }
        
        // ì•± ì„¤ì¹˜ ì™„ë£Œ ì´ë²¤íŠ¸
        window.addEventListener('appinstalled', (evt) => {
            console.log('ì•± ì„¤ì¹˜ ì™„ë£Œ');
            isInstalled = true;
            showStatus('ğŸ‰ í™ˆ í™”ë©´ì— ì„±ê³µì ìœ¼ë¡œ ì„¤ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            setTimeout(() => {
                goToGame();
            }, 2000);
        });
        
        // ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ì„ ë™ì ìœ¼ë¡œ ìƒì„±
        const manifestData = {
            "name": "ì‹œë‹ˆì–´ ê²Œì„",
            "short_name": "ì‹œë‹ˆì–´ê²Œì„",
            "description": "ì‹œë‹ˆì–´ë¥¼ ìœ„í•œ ì¬ë¯¸ìˆëŠ” ê²Œì„",
            "start_url": "/",
            "display": "standalone",
            "background_color": "#4CAF50",
            "theme_color": "#4CAF50",
            "orientation": "portrait",
            "icons": [
                {
                    "src": "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjE5MiIgaGVpZ2h0PSIxOTIiIHJ4PSIzMiIgZmlsbD0iIzRDQUY1MCIvPjx0ZXh0IHg9Ijk2IiB5PSIxMjAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSI4MCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPvCfOK48L3RleHQ+PC9zdmc+",
                    "sizes": "192x192",
                    "type": "image/svg+xml",
                    "purpose": "any maskable"
                },
                {
                    "src": "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMiA1MTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiIHJ4PSI4MCIgZmlsbD0iIzRDQUY1MCIvPjx0ZXh0IHg9IjI1NiIgeT0iMzIwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjIwIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+8J84rjwvdGV4dD48L3N2Zz4=",
                    "sizes": "512x512",
                    "type": "image/svg+xml",
                    "purpose": "any maskable"
                }
            ]
        };
        
        // ë§¤ë‹ˆí˜ìŠ¤íŠ¸ë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ê³  ë§í¬
        const manifestBlob = new Blob([JSON.stringify(manifestData)], { type: 'application/json' });
        const manifestUrl = URL.createObjectURL(manifestBlob);
        document.querySelector('link[rel="manifest"]').href = manifestUrl;
    </script>
</body>
</html>
